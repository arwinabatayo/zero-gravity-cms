image: c33s/php:7.1

stages:
    - test

variables:
    COMPOSER_ALLOW_SUPERUSER:       '1'
    COMPOSER_NO_INTERACTION:        '1'
    SYMFONY_DEPRECATIONS_HELPER:    'weak'
    TIMEZONE:                       'Europe/Vienna'
cache:
    key: "$CI_BUILD_NAME/$CI_BUILD_REF_NAME"
    paths:
        - "$COMPOSER_HOME"
        - "$CI_PROJECT_DIR/.ci"

before_script:
    - pwd
    - ls -lsa

####################################################################################################
# _____         _
#|_   _|__  ___| |_
#  | |/ _ \/ __| __|
#  | |  __/\__ \ |_
#  |_|\___||___/\__|
####################################################################################################
test:
    stage: test
    script:
        - rm -rf $CI_PROJECT_DIR/.ci
        - robo init
        - ls -lsa $CI_PROJECT_DIR/.ci
        - robo test
        - cat tests/_output/coverage.txt
    artifacts:
        paths:
            - tests/_output/

####################################################################################################
#  ____ _               _
# / ___| |__   ___  ___| | __
#| |   | '_ \ / _ \/ __| |/ /
#| |___| | | |  __/ (__|   <
# \____|_| |_|\___|\___|_|\_\
####################################################################################################
check:
    stage: test
    script:
        - rm -rf $CI_PROJECT_DIR/.ci
        - robo init
        - ls -lsa $CI_PROJECT_DIR/.ci
        - robo check
